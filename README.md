# MirKva
__HEparsing.ipynb__ = парсинг сайта продажи недвижимости.

__HOMEEscapeS.ipynb__ = основная работа над проектом тут.

__dataMirKvart.csv__ = полученные данные после парсинга.

__Книга2 (5).xlsv__ = данные по широте и долготе станций метро.




__1. Выбор темы__

Задача проекта нашей команды заключалась в прогнозировании стоимости квартир с помощью анализа и соответственно, построения регрессионных моделей. 
Набор данных состоял из основной переменной, такой как стоимость недвижимости и характеристик к ней.
Чтобы получить данные, мы использовали сайт: https://www.mirkvartir.ru/Москва/без-посредников/.

Основной критерий отбора - покупка квартиры в Москве у собственника , без посредников или агентств.

__2. Сбор данных__

Парсинг данных происходил вместе с материалами данного видеоролика: https://www.youtube.com/watch?embeds_referring_euri=https%3A%2F%2Fvk.com%2F&embeds_referring_origin=https%3A%2F%2Fvk.com&source_ve_path=MzY4NDIsMTY0OTksMjg2NjQsMTY0NTA2&feature=emb_share&v=0ws5tsRBgL8

Данные были представлены в виде страниц с объявлениями, на которых была отображена основная информация о продаже квартиры.

__3. Предварительная обработка__

На выходе мы получили следующие данные:

Link - ссылка на конкретное объявление о продаже квартиры

Name - наименование в объявлении (кол-во комнат, метраж, этаж) позднее такую переменную убрали и разделили наименование на 3 признака для дальнейшего исследования.

room - количество комнат в квартире

area (m^2) - метраж конкретной квартиры

floor - этаж

subway - станции метро ,в районе которых располагается квартира

sub_time - расстояние от квартиры до метро

address - адрес

price - стоимость квартиры



__4. Создание новых признаков__

Чтобы проверить некоторые гипотезы, мы решили обогатить наш датасет. А именно добавить широту и долготу станций метро Москвы, где располагаются продаваемые собственниками квартиры. Необходимые нам координаты были получены с помощью

1) https://yandex.ru/maps/213/moscow/?ll=37.262810%2C55.618702&z=14

2) https://www.ruscript.net/scripts/275/

Для большей наглядности мы добавили тепловую карту. На ней можно увидеть районы продажи квартир. Насыщенный красный цвет - самая дорогая квартира.

Также, добавили данные о лифте, лифт должен быть во всех зданиях выше 5 этажа и новый признак "Средняя стоимость квартиры за квадратный метр".


__5. Визуализация и гипотезы__

Во первых, мы решили сделать график распределения цен по квартирам. Это было сделано с целью оценки нашего датасета и определения типа распределения.
(Группируем данные по ценам и считаем количество квартир в каждом диапазоне)

Далее мы определили границы для Москвы, Мо, чтобы построить тепловую карту по координатам станций метро, отображенных в нашем датасете.

Наши предположения для дальнейшей проверки гипотез:

Квартиры с большей площадью имеют более высокую стоимость.
Чем ближе квартира расположена к центру Москвы, тем выше ее стоимость.
Квартиры на высоких этажах дороже, чем на низких.
Квартиры с большим количеством комнат имеют более высокую стоимость.
Квартиры на первом этаже дешевле, чем на остальных этажах.
Квартиры в районах, где метро находится в пешей доступности (или близко), имеют более высокую стоимость.
Квартиры в домах с лифтом дороже, чем в домах без лифта.

__1) Влияние близости к метро на цену квартиры.__ (Нельзя сказать однозначно)

__2) Зависимость стоимости квартиры от ее расположения.__ (Гипотеза подтверждается)

__3) Зависимость стоимости квартиры от этажа.__ (Нельзя сказать однозначно)

__4) Зависимость стоимости квартиры от количества комнат.__ (Однозначно нельзя сказать)
поэтому мы проверили зависимость от метража:

__5) Зависимость стоимости квартиры от ее метража.__ (Гипотеза в итоге подтвердилась)

__6) Зависимость стоимости квартиры от наличия лифта.__ (Однозначно сказать нельзя)

Наибольшую зависимость мы получили в гипотезе про квартиры, которые находятся в пятиэтажных зданиях и ниже + находятся ближе к москве стоят дороже. 
Посмотрели сколько у нас всего значений по этажам и сколько у нас квартир с этажом ниже 10.
Результаты теста Шапиро-Уилка для обеих выборок показывают, что данные не распределены нормально (p-value < 0.05). Поэтому мы будем использовать непараметрический тест Манна-Уитни для проверки гипотезы о равенстве средних значений двух выборок:

Результат теста Манна-Уитни показывает, что различия между средними значениями цен на квартиры на этажах ниже и выше 10 являются статистически значимыми (p-value < 0.05). Гипотеза о равенстве медиан отвергается в пользу альтернативной гипотезы о том, что медианы выборок различны

Также мы проверили гипотезу о зависимости близости к метро и отдаленностью от центра города. Рассчитали коэффициент корреляции Пирсона и p-value.
На основе этих результатов можно сделать вывод, что между близостью к метро и отдаленностью от центра города нет линейной зависимости. Коэффициент Пирсона близок к нулю, что говорит о том, что нет линейной связи между этими переменными. Однако, коэффициент Спирмена больше, что может указывать на монотонную связь между близостью к метро и отдаленностью от центра города. Однако, p-value для обоих коэффициентов выше уровня значимости 0.05, что означает, что мы не можем отвергнуть нулевую гипотезу о том, что нет связи между этими переменными.

__7. Машинное обучение__

Мы подготовили наш датасет для обучения.

Мы выбираем два различных метода для построения моделей и проведения сравнительного анализа результатов:

1.Линейная регрессия (Linear Regression): Это простой и широко используемый метод, который ищет линейную зависимость между входными переменными и целевой переменной. Он предполагает, что целевая переменная может быть предсказана с помощью линейной комбинации входных переменных. Линейная регрессия может быть полезна, когда есть явная линейная связь между признаками и целевой переменной или когда размер выборки относительно небольшой.

2.Лес решающих деревьев (Random Forest): Это ансамблевый метод, который комбинирует множество решающих деревьев для получения более точных прогнозов. Он основан на идее построения множества деревьев и объединения их предсказаний. Лес решающих деревьев может быть эффективным, когда данные содержат нелинейные зависимости или взаимодействия между признаками.

Далее мы разделили наш датасет на обучающую и тестовую выборку. Была создана модель для лин. регрессии и случайного влеса. Следующий шаг - обучение модели.Получили прогнозы и перешли к визуализации. 
В итоге получили такой результат, что модель случайного влеса как будто лучше сработала. Проверим действительно ли это так.

Для оценки качества регрессионной модели и вычисления метрик mean_absolute_error (средняя абсолютная ошибка) и mean_squared_error (средняя квадратичная ошибка) можно воспользоваться функциями из библиотеки sklearn.metrics

Полученные значения метрик качества модели указывают на следующее:

Mean Absolute Error (MAE): 8,080,232.57 MAE представляет собой среднюю абсолютную ошибку предсказания модели. Значение MAE указывает на среднюю разницу между фактическими значениями цены и предсказанными значениями. В данном случае, средняя абсолютная ошибка составляет около 8,080,232 рублей. Чем ближе значение MAE к нулю, тем лучше модель.

Mean Squared Error (MSE): 445,076,832,948,913.56 MSE измеряет среднее квадратичное отклонение предсказанных значений от фактических значений. Значение MSE составляет около 45,076,832,948,913 рублей в квадрате. MSE штрафует большие отклонения сильнее, чем MAE.

R-squared: 0.862 Коэффициент детерминации (R-squared) показывает, насколько хорошо модель объясняет вариацию целевой переменной. Значение R-squared около 0.862 означает, что примерно 86% вариации цены объясняется моделью. Чем ближе значение R-squared к 1, тем лучше соответствие модели данным.

Далее мы провели градиентный бустинг. 

Значения метрик качества модели немного улучшились:

Средняя абсолютная ошибка (Mean Absolute Error) уменьшилась до 2,868,698.47

Средняя квадратичная ошибка (Mean Squared Error) уменьшилась до 6,733,995,503,789,233.5

Коэффициент детерминации (R-squared) уменьшился до 0.7726




